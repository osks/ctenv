name: Test

on: [push, pull_request]

permissions:
  contents: read

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.11", "3.12", "3.13"]
    steps:
    - uses: actions/checkout@v4
    - name: Install the latest version of uv
      uses: astral-sh/setup-uv@v6
      with:
        enable-cache: true
        cache-dependency-path: pyproject.toml
    - name: Download gosu binary
      run: |
        # Download gosu binary for testing
        GOSU_VERSION="1.17"
        wget -O gosu "https://github.com/tianon/gosu/releases/download/${GOSU_VERSION}/gosu-amd64"
        chmod +x gosu
        echo "Downloaded gosu ${GOSU_VERSION}"
    - name: Install dependencies
      run: |
        make dev
    - name: Run tests
      run: |
        make test

